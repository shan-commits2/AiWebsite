<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Geminisa</title>
  </head>
  <body>
    <div id="root"></div>

    <!-- Session ID Setup -->
    <script>
      // Create a sessionId if one doesn't exist
      if (!localStorage.getItem('sessionId')) {
        localStorage.setItem('sessionId', crypto.randomUUID());
      }
      const sessionId = localStorage.getItem('sessionId');
      window.sessionId = sessionId;

      // Wrap fetch to inject sessionId into all requests
      const originalFetch = window.fetch;
      window.fetch = async (input, init = {}) => {
        let url = typeof input === "string" ? input : input.url;
        const method = (init.method || "GET").toUpperCase();

        // Always include sessionId â€” body for JSON, query param otherwise
        if (["GET"].includes(method)) {
          const urlObj = new URL(url, window.location.origin);
          urlObj.searchParams.set("sessionId", sessionId);
          url = urlObj.toString();
        } 
        else if (["POST", "PATCH", "DELETE"].includes(method)) {
          // If sending JSON body
          if (init.headers && init.headers["Content-Type"] === "application/json") {
            const body = init.body ? JSON.parse(init.body) : {};
            body.sessionId = sessionId;
            init.body = JSON.stringify(body);
          } else {
            // If no JSON body, attach sessionId as query param
            const urlObj = new URL(url, window.location.origin);
            urlObj.searchParams.set("sessionId", sessionId);
            url = urlObj.toString();
          }
        }

        return originalFetch(url, init);
      };
    </script>

    <script type="module" src="/src/main.tsx"></script>
    <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script>
  </body>
</html>
